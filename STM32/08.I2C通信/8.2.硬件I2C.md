## 1 I2C外设简介
- STM32内部集成了硬件I2C收发电路，可以由硬件自动执行时钟生成、起始终止条件生成、应答位收发、数据收发等功能，减轻CPU的负担
- 支持多主机模型
- 支持7位/10位地址模式
- 支持不同的通讯速度，标准速度(高达100 kHz)，快速(高达400 kHz)
- 支持DMA
- 兼容SMBus协议

>STM32F103C8T6 硬件I2C资源：I2C1、I2C2

## 2 I2C框图
<br/>
<div><img src = "./images/I2C框图.png"></div>
<br/>

>- 要发送数据时，将数据放入DR寄存器，当数据移位寄存器空闲时，便会将DR寄存器的值挪到数据移位寄存器中，进而发送出去。移位过程中便可将下一个数据放入DR中。
当将DR内的数据放入数据移位寄存器时，便会置 $\color{orange}{发送寄存器为空标志位TXE}$ 。  
>- 接收数据时数据经由SDA挪到数据移位寄存器，当一个字节的数据收齐之后，整体会被挪到DR中，然后置 $\color{orange}{发送寄存器非空标志位RXNE}$ 。此时便可从DR中读取数据。  

## 2 I2C基本结构
<br/>
<div><img src = "./images/I2C基本结构.png"></div>
<br/>

##  接收发送流程及软硬件波形对比
**主机发送：**  
<br/>
<div><img src = "./images/主机发送.png"></div>
<br/>

**主机接收：**  
<br/>
<div><img src = "./images/主机接收.png"></div>
<br/>

>主机发送和就收的流程基本和8.1节的波形流程一致。  

**软硬件波形对比：**  
<br/>
<div><img src = "./images/软硬件波形对比.png"></div>
<br/>

>软件模拟的时序不如硬件的规整。而且硬件向SDA放数据基本在时钟上升沿进行，读取数据基本在时钟下降沿进行。
