# 1.看门狗简介
- 看门狗可以监控程序的运行状态，当程序因为设计漏洞、硬件故障、电磁干扰等原因，出现卡死或跑飞现象时，看门狗能及时复位程序，避免程序陷入长时间的罢工状态，保证系统的可靠性和安全性
- 看门狗本质上是一个定时器，当指定时间范围内，程序没有执行喂狗（重置计数器）操作时，看门狗硬件电路就自动产生复位信号
- STM32内置两个看门狗
  - 独立看门狗（IWDG）：独立工作，对时间精度要求较低
  - 窗口看门狗（WWDG）：要求看门狗在精确计时窗口起作用

# 2.IWDG独立看门狗
# 2.1 IWDG框图
<div><img src = "./images/14.1-IWDG框图.png"></div>

# 2.2IWDG键寄存器
- 键寄存器本质上是控制寄存器，用于控制硬件电路的工作
- 在可能存在干扰的情况下，一般通过在整个键寄存器写入特定值来代替控制寄存器写入一位的功能，以降低硬件电路受到干扰的概率
<div><img src = "./images/14.1-IWDG键寄存器.png"></div>

# 2.3 IWDG超时时间
- 超时时间： ${T}_ {IWDG}={T}_ {LSI}\times{PR预分频系数}\times(RL+1)$ 
- 其中： ${T}_ {LSI}= {1}/{{F}_{LSI}} $ 
<div><img src = "./images/14.1-IWDG超时时间.png"></div>

# 3.WWDG窗口看门狗
## 3.1 WWDG框图
<div><img src = "./images/14.1-WWDG框图.png"></div>

>- 递减计数器的最高位T6作为溢出标志位， $\color{red}{1}$ 为没溢出， $\color{red}{0}$ 为溢出。  
>- 如果把T6位看做计数器的一部分，则溢出条件为计数值由 $\color{red}{1000000}$ 减到  $\color{red}{0111111}$ 。如果把T6位看做单纯的标志位，则溢出条件为低六位减为 $\color{red}{0}$ 。  
>- WDGA为窗口看门狗使能位。  
>- 窗口看门狗的复位：  
>>- 上限窗口复位：超过上限时间没有喂狗，则计数溢出标志位申请复位。  
>>- 下限窗口复位：喂狗太快导致计数值大于下限时间配置寄存器WWDG_CFG，,比较结果为1，申请复位  

## 3.2 WWDG工作特性
- 递减计数器T[6:0]的值小于0x40时，WWDG产生复位
- 递减计数器T[6:0]在窗口W[6:0]外被重新装载时，WWDG产生复位
- 递减计数器T[6:0]等于0x40时可以产生早期唤醒中断（EWI），用于重装载计数器以避免WWDG复位
- 定期写入WWDG_CR寄存器（喂狗）以避免WWDG复位
<div><img src = "./images/14.1-WWDG时序图.png"></div>

## 3.3 WWDG超时时间
- 超时时间：  
  ${T}_ {WWDG} = {T}_ {PCLK1}\times{4096}\times{WDGTB预分频系数}\times{(T[5:0] + 1)}$ 
- 窗口时间：  
	${T}_ {WIN} = {T}_ {PCLK1}\times{4096}\times{WDGTB预分频系数}\times{(T[5:0] - W[5:0])}$ 
- 其中：  
  ${T}_ {PCLK1} = {1} / {F}_ {PCLK1}$ 
<div><img src = "./images/14.1-WWDG超时时间计算.png"></div>

# 4.IWDG和WWDG比较
<div><img src = "./images/14.1-IWDG和WWDG比较.png"></div>
